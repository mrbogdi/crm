<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mrbogdi - home</title>
  <script type="module" src="https://unpkg.com/@fluentui/web-components"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
      background-color: #f3f3f3;
    }
    fluent-tabs::part(tab) {
      font-size: 1rem;
    }
    fluent-card {
      padding: 1rem;
      margin-bottom: 1rem;
      max-width: 500px;
    }
    aside {
      width: 60px;
      background-color: white;
      border-right: 1px solid #ccc;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 0;
    }
    aside fluent-button {
      width: auto;
      height: 40px;
      margin-bottom: 0.5rem;
      padding: 0;
      min-width: 40px;
    }
    main {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem;
    }
    fluent-button {
      margin-top: 0.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.5rem;
      border: 1px solid #ccc;
      text-align: left;
    }
    .hidden {
      display: none;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    fluent-text-field {
      display: block;
      margin-bottom: 0.5rem;
      width: 100%;
    }
    #pinScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #dashboardCard {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .stat-box {
      background: #fff;
      border: 1px solid #ddd;
      padding: 1rem;
      border-radius: 8px;
      flex: 1 1 120px;
      text-align: center;
    }
    #chartContainer {
      margin-top: 2rem;
      background: white;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <aside>
    <fluent-button title="Clien»õi" onclick="switchTab('clienti')">üìá</fluent-button>
    <fluent-button title="Contracte" onclick="switchTab('contracte')">üìÑ</fluent-button>
    <fluent-button title="Abonamente" onclick="switchTab('abonamente')">üì¶</fluent-button>
    <fluent-button title="Tracking HR" onclick="switchTab('hr')">üë•</fluent-button>
    <fluent-button title="Dashboard" onclick="switchTab('dashboard')">üìä</fluent-button>
    <fluent-button title="Export" appearance="accent" onclick="exportData()">‚¨áÔ∏è</fluent-button>
    <fluent-button title="Import" onclick="importData()">‚¨ÜÔ∏è</fluent-button>
    <fluent-button title="Reset" appearance="stealth" onclick="clearData()">üóëÔ∏è</fluent-button>
  </aside>

  <main>
    <div class="top-bar">
      <h2 id="sectionTitle">Clienti</h2>
      <span id="status"></span>
    </div>

    <div id="pinScreen">
      <h3>SeteazƒÉ sau introdu PIN-ul de acces:</h3>
      <fluent-text-field type="password" id="pinInput" placeholder="PIN (minim 4 cifre)"></fluent-text-field>
      <fluent-button onclick="validatePin()">AcceseazƒÉ</fluent-button>
    </div>

    <section id="dashboardTab" class="hidden">
      <fluent-card>
        <h3>Dashboard sumar</h3>
        <div id="dashboardCard">
          <div class="stat-box"><strong>Clien»õi</strong><br><span id="countClienti">0</span></div>
          <div class="stat-box"><strong>Contracte</strong><br><span id="countContracte">0</span></div>
          <div class="stat-box"><strong>Abonamente</strong><br><span id="countAbonamente">0</span></div>
          <div class="stat-box"><strong>HR</strong><br><span id="countHr">0</span></div>
        </div>
      </fluent-card>
      <div id="chartContainer">
        <canvas id="crmChart" width="400" height="200"></canvas>
      </div>
    </section>
  </main>

  <input type="file" id="importFile" class="hidden" onchange="handleImport(event)" />

  <script>
    const tabs = ['clienti', 'contracte', 'abonamente', 'hr', 'dashboard'];
    const pinKey = 'crm_pin';
    const encryptionKey = 'crm2025!secure'; // simplificat pt demo

    let data = {
      clienti: [],
      contracte: [],
      abonamente: [],
      hr: []
    };

    function encryptData(obj) {
      return CryptoJS.AES.encrypt(JSON.stringify(obj), encryptionKey).toString();
    }

    function decryptData(ciphertext) {
      try {
        const bytes = CryptoJS.AES.decrypt(ciphertext, encryptionKey);
        return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
      } catch {
        return null;
      }
    }

    function validatePin() {
      const input = document.getElementById('pinInput').value;
      if (input.length >= 4) {
        const stored = localStorage.getItem(pinKey);
        if (!stored) {
          localStorage.setItem(pinKey, CryptoJS.SHA256(input).toString());
          saveData();
          unlockApp();
        } else if (stored === CryptoJS.SHA256(input).toString()) {
          const saved = decryptData(localStorage.getItem('crm_data'));
          if (saved) data = saved;
          unlockApp();
        } else {
          alert('PIN gre»ôit');
        }
      }
    }

    function unlockApp() {
      document.getElementById('pinScreen').style.display = 'none';
      switchTab('dashboard');
      renderChart();
    }

    function saveData() {
      localStorage.setItem('crm_data', encryptData(data));
    }

    function exportData() {
      const blob = new Blob([encryptData(data)], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'crm_data_secure.aes';
      a.click();
    }

    function importData() {
      document.getElementById('importFile').click();
    }

    function handleImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const result = decryptData(e.target.result);
        if (result) {
          data = result;
          saveData();
          switchTab('dashboard');
        } else {
          alert('Date corupte sau PIN gre»ôit');
        }
      };
      reader.readAsText(file);
    }

    function clearData() {
      if (confirm('E»ôti sigur cƒÉ vrei sƒÉ resetezi toate datele?')) {
        localStorage.removeItem('crm_data');
        data = { clienti: [], contracte: [], abonamente: [], hr: [] };
        saveData();
        switchTab('dashboard');
      }
    }

    function switchTab(tab) {
      tabs.forEach(t => {
        const el = document.getElementById(t + 'Tab');
        if (el) el.classList.add('hidden');
      });
      const current = document.getElementById(tab + 'Tab');
      if (current) current.classList.remove('hidden');
      document.getElementById('sectionTitle').innerText = tab.charAt(0).toUpperCase() + tab.slice(1);
      updateDashboard();
      renderChart();
    }

    function updateDashboard() {
      document.getElementById('countClienti').innerText = data.clienti.length;
      document.getElementById('countContracte').innerText = data.contracte.length;
      document.getElementById('countAbonamente').innerText = data.abonamente.length;
      document.getElementById('countHr').innerText = data.hr.length;
    }

    function renderChart() {
      if (!document.getElementById('crmChart')) return;
      const ctx = document.getElementById('crmChart').getContext('2d');
      if (window.crmChartInstance) window.crmChartInstance.destroy();
      window.crmChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Clien»õi', 'Contracte', 'Abonamente', 'HR'],
          datasets: [{
            label: '√énregistrƒÉri',
            data: [data.clienti.length, data.contracte.length, data.abonamente.length, data.hr.length],
            backgroundColor: ['#0078D4', '#107C10', '#E81123', '#FFB900']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: { display: true, text: 'Statistici CRM' }
          }
        }
      });
    }
  </script>
</body>
</html>
