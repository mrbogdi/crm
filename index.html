<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mrbogdi - home</title>
  <script type="module" src="https://unpkg.com/@fluentui/web-components"></script>
  <style>
    :root {
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
      background-color: #f3f3f3;
    }
    fluent-tabs::part(tab) {
      font-size: 1rem;
    }
    fluent-card {
      padding: 1rem;
      margin-bottom: 1rem;
    }
    aside {
      width: 250px;
      background-color: white;
      border-right: 1px solid #ccc;
      display: flex;
      flex-direction: column;
      padding: 1rem;
    }
    main {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem;
    }
    fluent-button {
      width: 100%;
      margin-bottom: 0.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.5rem;
      border: 1px solid #ccc;
      text-align: left;
    }
    .hidden {
      display: none;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    fluent-text-field {
      display: block;
      margin-bottom: 0.5rem;
      width: 100%;
    }
    #pinScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <aside>
    <h2>CRM Rapid</h2>
    <fluent-button onclick="switchTab('clienti')">📇 Clienți</fluent-button>
    <fluent-button onclick="switchTab('contracte')">📄 Contracte</fluent-button>
    <fluent-button onclick="switchTab('abonamente')">📦 Abonamente</fluent-button>
    <fluent-button onclick="switchTab('hr')">👥 Tracking HR</fluent-button>
    <fluent-button appearance="accent" onclick="exportData()">⬇️ Export</fluent-button>
    <fluent-button onclick="importData()">⬆️ Import</fluent-button>
    <fluent-button appearance="stealth" onclick="clearData()">🗑️ Reset</fluent-button>
  </aside>

  <main>
    <div class="top-bar">
      <h2 id="sectionTitle">Clienti</h2>
      <span id="status"></span>
    </div>

    <div id="pinScreen">
      <h3>Setează sau introdu PIN-ul de acces:</h3>
      <fluent-text-field type="password" id="pinInput" placeholder="PIN (minim 4 cifre)"></fluent-text-field>
      <fluent-button onclick="validatePin()">Accesează</fluent-button>
    </div>

    <section id="clientiTab">
      <fluent-card>
        <h3>Adaugă client</h3>
        <fluent-text-field id="clientNume" placeholder="Nume"></fluent-text-field>
        <fluent-text-field id="clientEmail" placeholder="Email"></fluent-text-field>
        <fluent-button onclick="addItem('clienti')">Adaugă</fluent-button>
      </fluent-card>
      <fluent-card>
        <h3>Listă clienți</h3>
        <table id="clientiTable"></table>
      </fluent-card>
    </section>

    <section id="contracteTab" class="hidden">
      <fluent-card>
        <h3>Adaugă contract</h3>
        <fluent-text-field id="contractClient" placeholder="Client"></fluent-text-field>
        <fluent-text-field id="contractNr" placeholder="Nr. Contract"></fluent-text-field>
        <fluent-text-field id="contractStart" placeholder="Dată start"></fluent-text-field>
        <fluent-text-field id="contractSfarsit" placeholder="Dată sfârșit"></fluent-text-field>
        <fluent-button onclick="addItem('contracte')">Adaugă</fluent-button>
      </fluent-card>
      <fluent-card>
        <h3>Listă contracte</h3>
        <table id="contracteTable"></table>
      </fluent-card>
    </section>

    <section id="abonamenteTab" class="hidden">
      <fluent-card>
        <h3>Adaugă abonament</h3>
        <fluent-text-field id="abonamentTip" placeholder="Tip abonament"></fluent-text-field>
        <fluent-text-field id="abonamentVal" placeholder="Valabilitate"></fluent-text-field>
        <fluent-button onclick="addItem('abonamente')">Adaugă</fluent-button>
      </fluent-card>
      <fluent-card>
        <h3>Listă abonamente</h3>
        <table id="abonamenteTable"></table>
      </fluent-card>
    </section>

    <section id="hrTab" class="hidden">
      <fluent-card>
        <h3>Adaugă candidat</h3>
        <fluent-text-field id="hrNume" placeholder="Nume candidat"></fluent-text-field>
        <fluent-text-field id="hrPozitie" placeholder="Pozitie aplicată"></fluent-text-field>
        <fluent-button onclick="addItem('hr')">Adaugă</fluent-button>
      </fluent-card>
      <fluent-card>
        <h3>Listă candidați</h3>
        <table id="hrTable"></table>
      </fluent-card>
    </section>
  </main>

  <input type="file" id="importFile" class="hidden" onchange="handleImport(event)" />

  <script>
    const tabs = ['clienti', 'contracte', 'abonamente', 'hr'];
    const pinKey = 'crm_pin';

    let data = {
      clienti: [],
      contracte: [],
      abonamente: [],
      hr: []
    };

    function switchTab(tab) {
      tabs.forEach(t => {
        document.getElementById(t + 'Tab').classList.add('hidden');
      });
      document.getElementById(tab + 'Tab').classList.remove('hidden');
      document.getElementById('sectionTitle').innerText = tab.charAt(0).toUpperCase() + tab.slice(1);
      renderTable(tab);
    }

    function addItem(tab) {
      const fields = {
        clienti: ['clientNume', 'clientEmail'],
        contracte: ['contractClient', 'contractNr', 'contractStart', 'contractSfarsit'],
        abonamente: ['abonamentTip', 'abonamentVal'],
        hr: ['hrNume', 'hrPozitie']
      };
      const values = fields[tab].map(id => document.getElementById(id).value.trim());
      if (values.some(v => !v)) return alert('Completează toate câmpurile.');
      data[tab].push(values);
      saveData();
      renderTable(tab);
      fields[tab].forEach(id => document.getElementById(id).value = '');
    }

    function renderTable(tab) {
      const table = document.getElementById(tab + 'Table');
      table.innerHTML = '';
      if (data[tab].length === 0) return table.innerHTML = '<tr><td colspan="5">Nimic de afișat.</td></tr>';
      data[tab].forEach((row, idx) => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement('td');
          td.textContent = cell;
          tr.appendChild(td);
        });
        const tdDel = document.createElement('td');
        tdDel.innerHTML = `<fluent-button appearance='stealth' onclick="deleteItem('${tab}', ${idx})">Șterge</fluent-button>`;
        tr.appendChild(tdDel);
        table.appendChild(tr);
      });
    }

    function deleteItem(tab, idx) {
      if (!confirm('Ești sigur că vrei să ștergi acest element?')) return;
      data[tab].splice(idx, 1);
      saveData();
      renderTable(tab);
    }

    function saveData() {
      localStorage.setItem('crm_data', JSON.stringify(data));
      document.getElementById('status').innerText = '✔️ Salvat';
      setTimeout(() => document.getElementById('status').innerText = '', 1500);
    }

    function loadData() {
      const saved = localStorage.getItem('crm_data');
      if (saved) data = JSON.parse(saved);
    }

    function exportData() {
      const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'crm_backup.json';
      a.click();
    }

    function importData() {
      document.getElementById('importFile').click();
    }

    function handleImport(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        data = JSON.parse(event.target.result);
        saveData();
        switchTab('clienti');
      };
      reader.readAsText(file);
    }

    function clearData() {
      if (confirm('Sigur vrei să ștergi toate datele?')) {
        localStorage.removeItem('crm_data');
        location.reload();
      }
    }

    function validatePin() {
      const pin = document.getElementById('pinInput').value;
      if (!pin || pin.length < 4) return alert('PIN invalid.');
      const stored = localStorage.getItem(pinKey);
      if (!stored) {
        localStorage.setItem(pinKey, pin);
        alert('PIN setat.');
        grantAccess();
      } else if (stored === pin) {
        grantAccess();
      } else {
        alert('PIN incorect!');
      }
    }

    function grantAccess() {
      document.getElementById('pinScreen').style.display = 'none';
      loadData();
      switchTab('clienti');
    }
  </script>
</body>
</html>
